rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

function isSignedIn(){
return request.auth != null;
}

function isOwnerId(){
return request.auth.uid == resource.data.ownderId;
}

function Get(path){
return get(/databases/$(database)/documents/$(path))
}   
    
    match /classes/{classId} {   
    allow read: if request.auth.uid in resource.data.participantsIds;
   	allow create: if isSignedIn();
   	allow update, delete: if isOwnerId();
    
     match /homework/{homeworkId} {
      allow read: if isSignedIn() && (request.auth.uid in Get(/classes/$(classId)).data.participantsIds);
    	allow create: if isSignedIn() && (request.auth.uid == Get(/classes/$(classId)).data.ownerId);
 
   		allow update, delete: if isOwnerId();
		}
    }
     match /users/{userId} {
   		allow read, update, delete: if isSignedIn() && request.auth.uid == userId;
      allow create: if isSignedIn();
		}
  }
}